# US-V1-03.2 : Génération Google Wallet

| Métadonnée | Valeur |
|------------|--------|
| **ID** | US-V1-03.2 |
| **Epic** | E-V1-03 : Cartes adhérent |
| **Milestone** | V1.0 |
| **Priorité** | P1 |
| **PRD** | [prd-faatere-v1.md](../../prd-faatere-v1.md) |

---

## User Story

**En tant que** gestionnaire,
**Je veux** générer un pass Google Wallet,
**Afin que** l'adhérent ait sa carte sur son téléphone Android.

---

## Critères d'acceptance

- [ ] Endpoint GET /members/:id/card/google-wallet
- [ ] Vérification hasPaid === true
- [ ] Retourne URL "Add to Google Wallet"
- [ ] Pass type : Generic
- [ ] Contenu : nom, photo (si supporté), numéro

---

## Configuration Google Wallet API

```typescript
// Configuration requise
GOOGLE_WALLET_ISSUER_ID=xxx
GOOGLE_WALLET_SERVICE_ACCOUNT_KEY=xxx
```

---

## Structure du Pass

```json
{
  "id": "faatere.member.{memberId}",
  "classId": "faatere.membercard",
  "genericType": "GENERIC_TYPE_UNSPECIFIED",
  "hexBackgroundColor": "#1e40af",
  "logo": {
    "sourceUri": { "uri": "https://faatere.pf/logo.png" }
  },
  "cardTitle": { "defaultValue": { "value": "FAATERE" } },
  "header": { "defaultValue": { "value": "{firstName} {lastName}" } },
  "textModulesData": [
    {
      "id": "memberNumber",
      "header": "Numéro adhérent",
      "body": "{memberNumber}"
    },
    {
      "id": "tomite",
      "header": "Tomité",
      "body": "{tomiteName}"
    }
  ],
  "barcode": {
    "type": "QR_CODE",
    "value": "https://faatere.pf/verify/{memberId}"
  }
}
```

---

## Tâches techniques

### Backend

- [ ] Configurer compte Google Wallet Developer
- [ ] Créer classe de pass (une fois)
- [ ] Implémenter génération d'objet pass
- [ ] Signer l'URL d'ajout
- [ ] Retourner l'URL

### Frontend

- [ ] Bouton "Ajouter à Google Wallet"
- [ ] Ouvrir l'URL dans une nouvelle fenêtre
- [ ] Icône Google Wallet officielle

---

## Dépendances

- US-V1-03.1 : Génération carte PDF

---

## Notes

L'API Google Wallet nécessite un compte développeur et une vérification. Prévoir un délai de configuration.
