# US-V11-02.1 : Stockage local

| Métadonnée | Valeur |
|------------|--------|
| **ID** | US-V11-02.1 |
| **Epic** | E-V11-02 : Offline Mode |
| **Milestone** | V1.1 |
| **Priorité** | P0 |
| **PRD** | [prd-faatere-v1.md](../../prd-faatere-v1.md) |

---

## User Story

**En tant que** système mobile,
**Je veux** stocker les données localement,
**Afin de** fonctionner hors-ligne.

---

## Critères d'acceptance

- [ ] Base SQLite locale (expo-sqlite ou WatermelonDB)
- [ ] Schéma miroir des entités serveur
- [ ] Cache des adhérents du tomité
- [ ] File d'attente des mutations offline

---

## Schéma local

```typescript
// Tables locales
interface LocalMember {
  id: string; // UUID local ou serveur
  serverId: string | null; // ID serveur si synchronisé
  firstName: string;
  lastName: string;
  birthDate: string;
  birthPlace: string;
  address: string;
  email: string | null;
  phone: string | null;
  photoLocalPath: string | null; // Chemin local de la photo
  photoUrl: string | null;
  memberNumber: string | null; // Généré par serveur
  tomiteId: string;
  hasPaid: boolean;
  paymentMethod: string | null;
  syncStatus: 'synced' | 'pending' | 'conflict';
  localCreatedAt: string;
  localUpdatedAt: string;
  serverUpdatedAt: string | null;
}

interface PendingMutation {
  id: string;
  type: 'CREATE' | 'UPDATE' | 'DELETE';
  entityType: 'MEMBER';
  entityId: string;
  data: Record<string, any>;
  createdAt: string;
  retryCount: number;
}
```

---

## Tâches techniques

- [ ] Installer expo-sqlite ou WatermelonDB
- [ ] Créer schéma de base locale
- [ ] Implémenter service de stockage local
- [ ] Créer file d'attente des mutations
- [ ] Implémenter cache des adhérents au login
- [ ] Gérer les photos localement

---

## Dépendances

- US-V11-01.3 : Liste adhérents mobile

---

## Notes

WatermelonDB est recommandé pour les grandes quantités de données grâce à sa lazy loading et ses performances.
