# US-V11-03.2 : Résolution conflits

| Métadonnée | Valeur |
|------------|--------|
| **ID** | US-V11-03.2 |
| **Epic** | E-V11-03 : Synchronisation |
| **Milestone** | V1.1 |
| **Priorité** | P0 |
| **PRD** | [prd-faatere-v1.md](../../prd-faatere-v1.md) |

---

## User Story

**En tant que** utilisateur,
**Je veux** résoudre les conflits de sync,
**Afin de** ne pas perdre de données.

---

## Critères d'acceptance

- [ ] Détection conflit (version serveur différente)
- [ ] Modal de résolution
- [ ] Options : garder ma version, garder serveur, voir détails
- [ ] Log de la résolution

---

## Types de conflits

1. **Même entité modifiée** : L'adhérent a été modifié localement ET sur le serveur
2. **Suppression vs modification** : L'adhérent a été supprimé sur le serveur mais modifié localement
3. **Doublon détecté** : L'adhérent créé offline existe déjà sur le serveur

---

## Modal de résolution

```
┌─────────────────────────────┐
│ ⚠️ Conflit détecté          │
├─────────────────────────────┤
│                             │
│ Moana TETUANUI a été        │
│ modifié ailleurs            │
│                             │
│ ┌───────────┬───────────┐   │
│ │ Ma version│ Serveur   │   │
│ ├───────────┼───────────┤   │
│ │ Tel:      │ Tel:      │   │
│ │ 87 12 34  │ 87 65 43  │   │
│ └───────────┴───────────┘   │
│                             │
│ ○ Garder ma version         │
│ ○ Garder la version serveur │
│                             │
│ ┌───────────────────────┐   │
│ │      Résoudre         │   │
│ └───────────────────────┘   │
│                             │
└─────────────────────────────┘
```

---

## Tâches techniques

- [ ] Créer ConflictDetector
- [ ] Créer écran de résolution de conflit
- [ ] Afficher comparaison des versions
- [ ] Implémenter les 2 options de résolution
- [ ] Logger la décision de l'utilisateur
- [ ] Continuer la sync après résolution

---

## Stratégies de résolution

```typescript
type ConflictResolution =
  | 'KEEP_LOCAL'    // Garder la version locale
  | 'KEEP_SERVER'   // Garder la version serveur
  | 'MERGE';        // Fusion manuelle (future)
```

---

## Dépendances

- US-V11-03.1 : Sync automatique

---

## Notes

Les conflits doivent être rares si les utilisateurs travaillent sur des tomités différents (cloisonnement).
